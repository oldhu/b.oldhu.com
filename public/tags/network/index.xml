<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Network on OLDHU&#39;s BLOG</title>
    <link>http://b.oldhu.com/tags/network/index.xml</link>
    <description>Recent content in Network on OLDHU&#39;s BLOG</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://b.oldhu.com/tags/network/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Increase TCP max connections on Mac OS X</title>
      <link>http://b.oldhu.com/2012/07/19/increase-tcp-max-connections-on-mac-os-x/</link>
      <pubDate>Thu, 19 Jul 2012 00:00:00 +0000</pubDate>
      
      <guid>http://b.oldhu.com/2012/07/19/increase-tcp-max-connections-on-mac-os-x/</guid>
      <description>

&lt;h2 id=&#34;reason&#34;&gt;Reason&lt;/h2&gt;

&lt;p&gt;I was trying to benchmark a TCP based file server on Mac OS X. The server is running latest Node.js (0.8.2), while the client to push the server is written in &lt;a href=&#34;http://golang.org&#34;&gt;go&lt;/a&gt;. &amp;lsquo;Go&amp;rsquo; can start thousands of concurrent goroutines easily. I got error when there are hundreds of concurrent clients.&lt;/p&gt;

&lt;h2 id=&#34;steps&#34;&gt;Steps&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;increate max open files
&lt;pre&gt;
$ sysctl -a | grep files
kern.maxfiles = 12288
kern.maxfilesperproc = 10240
&lt;/pre&gt;
kern.maxfiles and kern.maxfilesperproc were small numbers, they need to be increased:
&lt;pre&gt;
$ sudo sysctl -w kern.maxfiles=12288
$ sudo sysctl -w kern.maxfilesperproc=10240
&lt;/pre&gt;
after this, you can increase your account&amp;rsquo;s limit by ulimit -n:
&lt;pre&gt;
$ ulimit -n 10240
&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;increate max sockets
&lt;pre&gt;
$ sysctl -a | grep somax
kern.ipc.somaxconn: 2048
&lt;/pre&gt;
It was a small number and need to be increased:
&lt;pre&gt;
$ sudo sysctl -w kern.ipc.somaxconn=2048
&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;references&#34;&gt;References&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://rolande.wordpress.com/2010/12/30/performance-tuning-the-network-stack-on-mac-osx-10-6/&#34;&gt;Performance Tuning the Network Stack on Mac OS X Â« Rolande&amp;rsquo;s Ramblings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://hints.macworld.com/article.php?story=20050901071836366&#34;&gt;A caution on modifying kern.maxfiles values &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>VMware Fusion Network Configuration</title>
      <link>http://b.oldhu.com/2009/07/15/vmware-fusion-network-configuration/</link>
      <pubDate>Wed, 15 Jul 2009 00:00:00 +0000</pubDate>
      
      <guid>http://b.oldhu.com/2009/07/15/vmware-fusion-network-configuration/</guid>
      <description>&lt;p&gt;VMware Fusion does not include a network configuration tool like in Windows. But it does not mean you cannot config it.&lt;/p&gt;

&lt;p&gt;When the system starts, it will load the plist file of /Library/LaunchDaemons/com.vmware.launchd.vmware.plist, which will call the script boot.sh under /Library/Application Support/VMware Fusion/&lt;/p&gt;

&lt;pre&gt;
	&amp;lt;dict&amp;gt;
	        &amp;lt;key&amp;gt;Label&amp;lt;/key&amp;gt;
	        &amp;lt;string&amp;gt;com.vmware.launchd.vmware&amp;lt;/string&amp;gt;
	        &amp;lt;key&amp;gt;ProgramArguments&amp;lt;/key&amp;gt;
	        &amp;lt;array&amp;gt;
	                &amp;lt;string&amp;gt;/Library/Application Support/VMware Fusion/boot.sh&amp;lt;/string&amp;gt;
	                &amp;lt;string&amp;gt;--start&amp;lt;/string&amp;gt;
	        &amp;lt;/array&amp;gt;
	        &amp;lt;key&amp;gt;RunAtLoad&amp;lt;/key&amp;gt;
	        &amp;lt;true/&amp;gt;
	&amp;lt;/dict&amp;gt;
&lt;/pre&gt;

&lt;p&gt;So, let&#39;s look into the boot.sh. boot.sh supports 3 commands: --start, --stop and --restart. If we want to disable some modules, we should modify the --start section.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;To disable dhcp&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Find all lines contain &#34;vmnet-dhcpd&#34; in --start section and comment them out.&lt;/p&gt; &lt;p&gt;&lt;strong&gt;To disable vmnet1&lt;/strong&gt;&lt;/p&gt; &lt;p&gt;Comment all lines contain &#34;vmnet1&#34; in --start section&lt;/p&gt; &lt;p&gt;&lt;strong&gt;To disable bridge&lt;/strong&gt;&lt;/p&gt; &lt;p&gt;Comment lines contain &#34;vmnet-bridge&#34; in --start secion&lt;/p&gt; &lt;p&gt;&lt;strong&gt;Config vmnet8&lt;/strong&gt;&lt;/p&gt; &lt;p&gt;vmnet8 is my favorite nat adapter, you can see it&#39;s configured using variables of $vmdb_answer_VNET_8_HOSTONLY_HOSTADDR and $vmdb_answer_VNET_8_HOSTONLY_NETMASK, which are set by this method: db_load &#39;vmdb&#39; &#34;$vmware_db&#34;. and vmware_db=&#34;$LIBDIR&#34;/locations.&lt;/p&gt; &lt;p&gt;So, to config vmnet8, you just modify the locations file: sudo vi ./locations&lt;/p&gt; &lt;p&gt;&lt;strong&gt;Config vmnet1&lt;/strong&gt;&lt;/p&gt; &lt;p&gt;The same as vmnet8&lt;/p&gt; &lt;p&gt;&lt;strong&gt;Config nat&lt;/strong&gt;&lt;/p&gt; &lt;p&gt;vmnet-natd is using the config file $LIBDIR/vmnet8/nat.conf, modify this file to config nat&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>